<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="extName">숲토킹 - 사이드패널</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="sidepanel.css">
  <link rel="stylesheet" href="donation-tab.css">
  <link rel="stylesheet" href="chat-tab.css">
</head>
<body>
  <!-- ===== 메인 탭 네비게이션 ===== -->
  <div class="main-tab-nav">
    <button class="main-tab-btn active" data-tab="monitoring">
      <span class="main-tab-icon">📺</span>
      <span class="main-tab-text" data-i18n="tabMonitoring">모니터링</span>
    </button>
    <button class="main-tab-btn" data-tab="donation">
      <span class="main-tab-icon">🎁</span>
      <span class="main-tab-text" data-i18n="tabDonation">내 후원</span>
    </button>
    <button class="main-tab-btn" data-tab="chat">
      <span class="main-tab-icon">💬</span>
      <span class="main-tab-text" data-i18n="tabChat">채팅</span>
    </button>
  </div>

  <!-- ===== 모니터링 탭 컨텐츠 ===== -->
  <div class="main-tab-content active" id="monitoringTabContent">
  <div class="container">
    <!-- 헤더 -->
    <header class="header">
      <div class="header-content">
        <div class="brand">
          <div class="brand-logo">📺</div>
          <div class="brand-text">
            <h1 id="brandText">숲토킹</h1>
            <p class="tagline creepy-text" data-i18n="taglineCreepy">내가 늘 지켜보고 있어..</p>
          </div>
        </div>
        <div class="header-actions">
          <div class="help-wrapper">
            <button class="icon-btn" id="helpBtn" data-i18n-title="helpTooltip" title="도움말">❓</button>
            <div class="help-tooltip">
              <p class="tooltip-title">📢 <span data-i18n="helpTitle">안내</span></p>
              <p data-i18n="helpMessage1">이 확장 프로그램은 개인 사용 목적으로 제작되었습니다.</p>
              <p data-i18n="helpMessage2">일부 버그나 예상치 못한 동작이 있을 수 있습니다.</p>
              <p data-i18n="helpMessage3">지속적으로 개선하고 있으니 양해 부탁드립니다.</p>
              <a href="https://github.com/musickiss/soop-streamer-alert/issues" target="_blank" class="tooltip-link" data-i18n="helpBugReport">버그 신고 →</a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- 모니터링 상태 바 -->
    <div class="monitoring-bar" id="monitoringBar">
      <div class="monitoring-status">
        <div class="status-indicator" id="statusIndicator">
          <span class="dot"></span>
          <span id="statusText" data-i18n="monitoringOff">모니터링 OFF</span>
        </div>
        <span class="monitoring-info" id="monitoringInfo">0명 모니터링</span>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" id="monitoringToggle">
        <span class="toggle-track"></span>
      </label>
    </div>

    <!-- 빠른 설정 -->
    <div class="quick-settings">
      <div class="setting-chip active" data-setting="notification" id="notificationChip">
        <span class="chip-icon">🔔</span>
        <span data-i18n="broadcastNotification">방송 알림</span>
      </div>
      <div class="setting-chip" data-setting="endNotification" id="endNotificationChip">
        <span class="chip-icon">⚫</span>
        <span data-i18n="endNotification">종료 알림</span>
      </div>
    </div>

    <!-- 현재 시청 중 섹션 (상단 고정) -->
    <section class="section now-watching" id="nowWatching">
        <div class="section-header">
          <div class="section-title">📺 <span data-i18n="nowWatching">현재 시청 중</span></div>
          <!-- ⭐ v3.7.0: 품질 선택 제거, 분할 크기만 오른쪽 배치 -->
          <select id="splitSizeSelect" class="quality-select" data-i18n-title="splitSize" title="분할 녹화 크기 선택">
            <option value="500" selected data-i18n-template="splitSize">분할: 500MB</option>
            <option value="1024" data-i18n-template="splitSize">분할: 1GB</option>
            <option value="2048" data-i18n-template="splitSize">분할: 2GB</option>
          </select>
        </div>

        <!-- SOOP 방송 시청 중일 때 -->
        <div class="current-stream-card" id="currentStreamCard" style="display: none;">
          <div class="stream-info-row">
            <div class="streamer-avatar" id="currentAvatar">
              <span class="live-ring"></span>
              <span id="currentAvatarText">-</span>
            </div>
            <div class="stream-details">
              <div class="streamer-name">
                <span id="currentStreamerName">-</span>
                <span class="live-badge">LIVE</span>
              </div>
              <div class="stream-title" id="currentStreamTitle">-</div>
            </div>
          </div>
          <!-- 녹화 시작 버튼 -->
          <div class="recording-controls" id="recordingControls">
            <button class="record-btn" id="startRecordingBtn">
              <span class="record-icon"></span>
              <span data-i18n="startRecording">녹화 시작</span>
            </button>
          </div>
        </div>

        <!-- SOOP 시청 중이 아닐 때 -->
        <div class="not-watching" id="notWatchingMessage">
          <div class="icon">📺</div>
          <p data-i18n="notWatchingMessage">SOOP 방송을 시청 중이 아닙니다</p>
        </div>
      </section>

    <!-- 리사이저블 영역 (녹화 중 + 즐겨찾기) -->
    <div class="resizable-area">
      <!-- 녹화 중 목록 섹션 -->
      <section class="section recordings-section" id="recordingsSection">
        <div class="section-header">
          <div class="section-title red">🔴 <span data-i18n="recording">녹화 중</span>
            <div class="info-tooltip-wrapper">
              <span class="info-icon">ⓘ</span>
              <div class="info-tooltip" id="recordingQualityInfoTooltip">
                <!-- 동적으로 채워짐 -->
              </div>
            </div>
          </div>
          <span class="section-badge recording-count" id="recordingCount">0</span>
        </div>

        <div class="recording-list" id="activeRecordingList">
          <!-- 동적으로 채워짐 -->
        </div>

        <div class="empty-recordings" id="noRecordingMessage" data-i18n="noRecordings">녹화 중인 방송이 없습니다</div>
      </section>

      <!-- 리사이즈 핸들 -->
      <div class="resize-handle" id="resizeHandle" data-i18n-title="resizeHandle" title="드래그하여 크기 조절"></div>

      <!-- 스트리머 목록 섹션 -->
      <section class="streamer-section" id="favoritesSection">
        <div class="section-header">
          <div class="section-title">⭐ <span data-i18n="favoriteStreamers">즐겨찾기 스트리머</span></div>
          <div class="section-actions">
            <button class="action-btn" id="importBtn" data-i18n-title="importTooltip" title="가져오기">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
            </button>
            <button class="action-btn" id="exportBtn" data-i18n-title="exportTooltip" title="내보내기">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
            </button>
            <input type="file" id="importFileInput" accept=".json" style="display: none;">
            <button class="action-btn" id="refreshBtn" data-i18n-title="refreshTooltip" title="새로고침">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"/>
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
              </svg>
            </button>
            <select id="filterSelect" class="filter-select">
              <option value="all" data-i18n="filterAll">전체</option>
              <option value="live" data-i18n="filterLive">방송중</option>
              <option value="offline" data-i18n="filterOffline">오프라인</option>
            </select>
          </div>
        </div>

        <div class="streamer-list" id="streamerList">
          <!-- 동적으로 채워짐 -->
        </div>
      </section>
    </div> <!-- resizable-area 끝 -->

    <!-- 하단 고정 영역 -->
    <div class="bottom-fixed">
      <!-- 스트리머 추가 폼 -->
      <div class="add-form">
        <div class="add-form-row">
          <input type="text"
                 class="add-input"
                 id="streamerIdInput"
                 data-i18n-placeholder="inputPlaceholder"
                 placeholder="스트리머 ID 입력 (예: streamer123)">
          <button class="add-btn" id="addStreamerBtn" data-i18n="addButton">추가</button>
        </div>
      </div>

      <!-- 저장 공간 바 -->
      <div class="storage-bar" id="storageBar">
        <div class="storage-info">
          <span class="storage-label">💾 <span data-i18n="storage">저장 공간</span></span>
          <span class="storage-value" id="storageValue">- / -</span>
        </div>
        <div class="storage-progress">
          <div class="storage-progress-fill" id="storageProgressFill" style="width: 0%"></div>
        </div>
      </div>

      <!-- 푸터 -->
      <footer class="footer">
        <span class="footer-links">
          <a href="https://www.sooplive.co.kr/station/teamilh" target="_blank">SOOP</a>
          <span>·</span>
          <a href="https://github.com/musickiss/soop-streamer-alert" target="_blank">GitHub</a>
          <span>·</span>
          <a href="https://github.com/musickiss/soop-streamer-alert/blob/master/PRIVACY.md" target="_blank" data-i18n="privacy">개인정보</a>
        </span>
        <span id="versionInfo">v2.0.0</span>
      </footer>
    </div>
  </div>

  <div class="toast" id="toast"></div>
  </div> <!-- monitoringTabContent 끝 -->

  <!-- ===== 내 후원 탭 컨텐츠 ===== -->
  <div class="main-tab-content" id="donationTabContent">
    <div class="donation-tab-container active" id="donationTabContainer">
      <!-- DonationTab 모듈이 동적으로 렌더링 -->
    </div>
  </div>

  <!-- ===== 채팅 수집 탭 컨텐츠 ===== -->
  <div class="main-tab-content" id="chatTabContent">
    <div class="chat-tab-container active" id="chatTabContainer">
      <!-- ChatTab 모듈이 동적으로 렌더링 -->
    </div>
  </div>

  <script src="sidepanel.js"></script>
  <script src="donation-tab.js"></script>
  <script src="chat-db.js"></script>
  <script src="chat-tab.js"></script>
</body>
</html>
